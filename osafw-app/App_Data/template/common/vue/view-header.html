<script type="text/x-template" id="view-header-template">
    <div class="page-header">
        <div class="page-header-row page-header-row-nav d-flex flex-wrap align-items-center gap-2">
            <div class="page-header-breadcrumbs d-flex flex-wrap align-items-center gap-2">
                <a href="#" class="btn btn-link px-0 text-decoration-none" @click.prevent="onBack">{{fwStore.list_title}}</a>
                <span class="text-muted">/</span>
            </div>
            <div class="page-header-record-nav ms-auto d-flex align-items-center gap-2 d-print-none">
                <a @click.prevent="onNext(true)" href="#" class="btn btn-link px-0"><i class="bi bi-arrow-left-circle"></i> `Prev`</a>
                <a @click.prevent="onNext()" href="#" class="btn btn-link px-0">`Next` <i class="bi bi-arrow-right-circle"></i></a>
            </div>
        </div>

        <div class="page-header-row page-header-row-title d-flex flex-wrap align-items-center gap-2">
            <div class="page-header-title flex-grow-1">
                <h1 class="page-title mb-0">
                    <span v-if="fwStore.is_loading_item"
                          class="spinner-border" role="status" aria-hidden="true"></span>
                    {{fwStore.view_title}}
                </h1>
            </div>
            <div class="page-header-meta d-flex flex-wrap align-items-center gap-2">
                <slot name="meta"></slot>
            </div>
        </div>

        <div class="page-header-row page-header-row-actions d-flex flex-wrap align-items-center gap-2">
            <div class="page-header-actions d-flex flex-wrap align-items-center gap-2">
                <slot name="beforeButtons"></slot>

                <a v-if="fwStore.return_url"
                   class="btn btn-default"
                   :href="fwStore.return_url"><i class="bi bi-arrow-left-circle"></i> `Return Back`</a>
                <a v-else
                   class="btn btn-default"
                   href="#"
                   @click.prevent="onBack"><i class="bi bi-arrow-left-circle"></i> `Back to List`</a>

                <div class="btn-group" v-if="uioptions.btnAddNew || $slots.group">
                    <a v-if="uioptions.btnAddNew"
                       class="btn btn-default"
                       href="#"
                       @click.prevent="onAddNew"
                       :disabled="fwStore.is_readonly"><i class="bi bi-plus-lg"></i> `Add New`</a>
                    <a v-if="current_id"
                       class="btn btn-primary"
                       href="#"
                       @click.prevent="onEdit"
                       :disabled="fwStore.is_readonly"><i class="bi bi-pencil-fill"></i> `Edit`</a>
                    <slot name="group"></slot>
                </div>
                <!--TODO /common/form/btn_userlists if="is_userlists"-->

                <slot></slot>
            </div>

            <div class="page-header-actions page-header-actions-extra d-flex flex-wrap align-items-center gap-2 ms-auto">
                <a v-if="item.status!=127"
                   class="btn btn-danger"
                   href="#"
                   @click.prevent="onDelete"><span class="text-danger"><i class="bi bi-x-circle-fill"></i></span> `Delete`</a>
                <template v-if="item.status==127">
                    <a v-if="fwStore.access_level==100"
                       class="btn btn-danger"
                       href="#"
                       @click.prevent="onDelete"><i class="bi bi-x-square-fill"></i> `Permanent Delete`</a>
                    <a class="btn btn-default"
                       href="#"
                       @click.prevent="onRestore"><span class="text-success"><i class="bi bi-check-circle-fill"></i></span> `Restore Deleted`</a>
                </template>
                <slot name="actions-right"></slot>
            </div>
        </div>

        <slot name="afterButtons"></slot>
    </div>
</script>

<script type="module">
    import { mapStores } from 'pinia';

    fwApp.component('view-header', {
        template: '#view-header-template',
        data: () => ({
        }),
        computed: {
            ...mapStores(fwStore), //accessible via this.fwStore
            uioptions() {
                return this.fwStore.uioptions.view.header ?? false;
            },
            current_id() {
                return this.fwStore.current_id ?? 0;
            },
            item() {
                return this.fwStore.edit_data?.i ?? [];
            }
        },
        methods: {
            onAddNew(e) {
                this.fwStore.openEditScreen(0);
            },
            onEdit(e) {
                this.fwStore.openEditScreen(this.current_id);
            },
            onBack() {
                this.fwStore.openListScreen();
            },
            async onDelete(e) {
                await this.fwStore.deleteRow(this.current_id);
                this.fwStore.openListScreen();
            },
            async onRestore(e) {
                await this.fwStore.restoreRow(this.current_id);
                await this.fwStore.loadItem(this.current_id);
            },
            async onNext(is_prev) {
                const id = await this.fwStore.getNextID(this.current_id, is_prev);
                await this.fwStore.openViewScreen(id);
            }
        }
    });
</script>
