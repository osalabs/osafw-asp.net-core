<script type="text/x-template" id="date-picker-template">
  <div class="input-group date">
    <input type="text" 
           class="form-control" 
           maxlength="10" 
           :placeholder="placeholder"
           :required="required"
           v-model="dateStr">
    <span class="input-group-append"><button class="btn btn-default" type="button"><~/common/icons/calendar3></button></span>
  </div>
</script>

<script type="module">
fwApp.component('date-picker', {
  template: '#date-picker-template',
  props: ['modelValue','placeholder', 'required'],
  emits: ['update:modelValue'],
  data: () => ({
      dateStr: this.modelValue
  }),
  watch: {
    dateStr (val) {
      $(this.$el).datepicker("update", new Date(val));
      this.$emit('update:modelValue', val);
    }
  },  
  mounted() {
    if (this.value) {
      this.dateStr = this.value;
    }
    $(this.$el).datepicker({
        format: '<~GLOBAL[datepicker_default_format]>',
        todayHighlight:'TRUE',
    	autoclose: true
    }).on('changeDate', (e) => {
      const dateObj = e.date;
      // Add +1 to month since js getMonth() return zero based value
      const month = String(dateObj.getMonth() + 1).padStart(2, '0');
      const day = String(dateObj.getDate()).padStart(2, '0');
      const year = dateObj.getFullYear();
      this.dateStr = year + '-' + month  + '-'+ day;
    });
  }
});
</script>