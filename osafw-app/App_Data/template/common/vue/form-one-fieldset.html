<script type="text/x-template" id="form-one-fieldset-template">
    <div :class="['fw-fieldset', def.class ? def.class : '', { 'is-collapsed': isCollapsed }]">
        <div v-if="def.label"
             :class="['fw-fieldset-legend', def.class_label ? def.class_label : '']"
             role="button"
             tabindex="0"
             @click="toggleCollapsed"
             @keydown="onLegendKeydown">
            {{ def.label }}
        </div>
        <form-one-def v-for="(child_def, index) in def.children"
                      :key="index"
                      :form="form"
                      @update-form-field="$emit('update-form-field', $event)"
                      @cancel-form="$emit('cancel-form', $event)"
                      :def="child_def"
                      :lookups="lookups" />
    </div>
</script>

<script type="module">
    fwApp.component('form-one-fieldset', {
        template: '#form-one-fieldset-template',
        props: {
            def: {
                type: Object,
                required: true
            },
            lookups: {
                type: Object,
                required: true
            },
            form: {
                type: Object,
                required: true
            }
        },
        emits: ['update-form-field', 'cancel-form']
        ,
        data: () => ({
            isCollapsed: false
        }),
        methods: {
            toggleCollapsed() {
                this.isCollapsed = !this.isCollapsed;
            },
            onLegendKeydown(event) {
                if (event.key !== 'Enter' && event.key !== ' ') return;
                event.preventDefault();
                this.toggleCollapsed();
            }
        }
    });
</script>
