<script type="text/x-template" id="edit-form-template">
  <div v-if="save_result && !save_result.success && save_result.err_msg>''" class="alert alert-danger">{{save_result.err_msg}}</div>
  <form v-if="fwStore.edit_data !== null"
    class="fw-card"
    @submit.prevent="saveChanges"
    @change.prevent="onChange"
  >
    <fieldset>
      <form-one-def v-for="(def,index) in fwStore.treeShowFormFields"
        :key="index"
        :form="fwStore.edit_data"
        @update-form-field="onUpdateFormField"
        @cancel-form="onCancelForm"
        :def="def"
        :lookups="fwStore.lookups"
      />
    </fieldset>
  </form>
</script>

<script type="module">
import { mapStores } from 'pinia';

fwApp.component('edit-form', {
  template: '#edit-form-template',
  props: {
    sampleProp: {
      type: String,
      required: false,
      default: ''
    }
  },
  emits: ['on-sample-event'],
  data: () => ({
    sample_value: 0,
  }),
  computed: {
    ...mapStores(useFwStore), //accessible via this.fwStore
    save_result() {
      return this.fwStore.edit_data?.save_result;
    },
  },
  async mounted(){
    console.log('edit-form mounted');
    if (this.fwStore.current_id) await this.fwStore.loadItem(this.fwStore.current_id);
  },
  unmounted(){
    console.log('edit-form unmounted');
  },
  updated(){
    console.log('edit-form updated');
  },
  methods: {
    onUpdateFormField({ field, value }) {
      //console.log('edit-form updateFormField', { field, value });
      this.fwStore.edit_data.i[field] = value;
    },
    onChange() {
      //console.log('edit-form onChange');
      this.saveChanges(); //save changes whenever form changed
    },
    saveChanges() {
      // Implement save logic here
      // console.log('edit-form saveChanges');
      this.fwStore.saveEditDataDebounced();
    },
    onCancelForm() {
      this.fwStore.openListScreen();
    },
  }
});
</script>
